<div class="form-wrapper">
  <form nz-form [formGroup]="userSearchForm" [nzLayout]="'inline'" class="ant-advanced-search-form">
    <div nz-row [nzGutter]="24" class="row-control">
      <div nz-col [nzSpan]="6">
        <nz-form-item class="search-form-item">
          <nz-form-label>昵称</nz-form-label>
          <nz-form-control nzErrorTip="请输入昵称!">
            <input type="text" nz-input formControlName="nickName" placeholder="请输入昵称" />
          </nz-form-control>
        </nz-form-item>
      </div>
      <div nz-col [nzSpan]="6">
        <nz-form-item>
          <nz-form-label>性别</nz-form-label>
          <nz-form-control nzErrorTip="请输入性别!">
            <nz-select formControlName="gender" nzAllowClear nzPlaceHolder="请选择性别">
              <nz-option *ngFor="let option of optionList" [nzValue]="option.value" [nzLabel]="option.label">
              </nz-option>
            </nz-select>
          </nz-form-control>
        </nz-form-item>
      </div>
      <div nz-col [nzSpan]="6">
        <nz-form-item>
          <nz-form-label>城市</nz-form-label>
          <nz-form-control nzErrorTip="请输入所属城市!">
            <input type="text" nz-input formControlName="city" placeholder="请输入所属城市" />
          </nz-form-control>
        </nz-form-item>
      </div>
      <div nz-col [nzSpan]="6">
        <nz-form-item>
          <nz-form-label>身份</nz-form-label>
          <nz-form-control nzErrorTip="请输入身份!">
            <nz-select formControlName="identity" nzAllowClear nzPlaceHolder="请选择身份">
              <nz-option *ngFor="let identity of identityList" [nzValue]="identity.value" [nzLabel]="identity.label">
              </nz-option>
            </nz-select>
          </nz-form-control>
        </nz-form-item>
      </div>
      <div nz-col [nzSpan]="6" *ngIf="isCollapse">
        <nz-form-item>
          <nz-form-label>手机号</nz-form-label>
          <nz-form-control nzErrorTip="请输入手机号!">
            <input type="text" nz-input formControlName="phone" placeholder="请输入手机号" />
          </nz-form-control>
        </nz-form-item>
      </div>
      <div nz-col [nzSpan]="6" *ngIf="isCollapse">
        <nz-form-item>
          <nz-form-label>激活码</nz-form-label>
          <nz-form-control nzErrorTip="请输入激活码!">
            <input type="text" nz-input formControlName="activeCode" placeholder="请输入激活码" />
          </nz-form-control>
        </nz-form-item>
      </div>
    </div>
    <div nz-row>
      <div nz-col [nzSpan]="24" class="search-area">
        <button nz-button [nzType]="'primary'" (click)="search()">查询</button>
        <button nz-button (click)="resetForm()">清空</button>
        <a class="collapse" (click)="isCollapse=!isCollapse">
          {{isCollapse ? '收起' : '展开'}}
          <i nz-icon [nzType]="isCollapse ? 'up' : 'down'"></i>
        </a>
      </div>

    </div>
  </form>
</div>
<button nz-button nzType="primary" class="reflesh-button">
  <i nz-icon nzType="sync"></i></button>
<button nz-button nzType="primary" class="add-button" (click)='showAddModal()'>新增</button>

<!-- 用户列表 -->
<nz-table #basicTable [nzData]="listOfData" [nzBordered]=true
  (nzCurrentPageDataChange)="onCurrentPageDataChange($event)">
  <thead>
    <tr>
      <th [(nzChecked)]="checked" [nzIndeterminate]="indeterminate" (nzCheckedChange)="onAllChecked($event)"></th>
      <th>昵称</th>
      <th>性别</th>
      <th>年龄</th>
      <th>手机号</th>
      <th>城市</th>
      <th>地址</th>
      <th>身份</th>
      <th>激活码</th>
      <th>创建时间</th>
      <th>操作</th>
    </tr>
  </thead>
  <tbody>
    <tr *ngFor="let data of basicTable.data ">
      <td [nzChecked]="setOfCheckedId.has(data.id)" (nzCheckedChange)="onItemChecked(data.id, $event)"></td>
      <td>{{ data.nickName }}</td>
      <td>{{ data.gender==0 ? '男':'女' }}</td>
      <td>{{ data.age }}</td>
      <td>{{ data.phone}}</td>
      <td>{{ data.city}}</td>
      <td>{{ data.address }}</td>
      <td>{{ data.identity==0 ? '游客':'侍卫' }}</td>
      <td>{{ data.activeCode }}</td>
      <td>{{ data.createTime | date: 'yyyy-MM-dd hh:mm:ss' }}</td>
      <td>
        <a (click)="showInfoModal(data.id)">详情</a>
        <nz-divider nzType="vertical"></nz-divider>
        <a (click)="showEditModal(data.id)">修改</a>

        <nz-divider nzType="vertical"></nz-divider>
        <a nz-popconfirm nzPopconfirmTitle="是否确认删除?" (nzOnConfirm)="delConfirm(data.id)" (nzOnCancel)="delCancel()"
          nzPopconfirmPlacement="bottomRight">删除</a>
      </td>
    </tr>
  </tbody>
</nz-table>

<!-- 用户详情 -->
<nz-modal [(nzVisible)]="isShowInfoUserModel" nzTitle="用户详情" [nzFooter]=null (nzOnCancel)="handleInfoUserCancel()">
  <form nz-form [formGroup]="userForm">
    <!-- 昵称 -->
    <nz-form-item>
      <nz-form-label [nzSpan]="6" nzRequired>昵称</nz-form-label>
      <nz-form-control [nzSpan]="12">
        <input nz-input formControlName="nickName" />
      </nz-form-control>
    </nz-form-item>
    <!-- 性别 -->
    <nz-form-item>
      <nz-form-label [nzSpan]="6" nzRequired>性别</nz-form-label>
      <nz-form-control [nzSpan]="12">
        <nz-radio-group formControlName="gender">
          <label nz-radio [nzValue]="o.value" *ngFor="let o of optionList">{{ o.label }}</label>
        </nz-radio-group>
      </nz-form-control>
    </nz-form-item>
    <!-- 年龄 -->
    <nz-form-item>
      <nz-form-label [nzSpan]="6" nzRequired>年龄</nz-form-label>
      <nz-form-control [nzSpan]="12">
        <input nz-input formControlName="age" />
      </nz-form-control>
    </nz-form-item>
    <!-- 手机号 -->
    <nz-form-item>
      <nz-form-label [nzSpan]="6">手机号</nz-form-label>
      <nz-form-control [nzSpan]="12">
        <input nz-input  formControlName="phone" />
      </nz-form-control>
    </nz-form-item>
    <nz-form-item>
      <nz-form-label [nzSpan]="6" nzRequired>城市</nz-form-label>
      <nz-form-control [nzSpan]="12">
        <input nz-input formControlName="city" />
      </nz-form-control>
    </nz-form-item>
    <!-- 地址 -->
    <nz-form-item>
      <nz-form-label [nzSpan]="6">地址</nz-form-label>
      <nz-form-control [nzSpan]="12">
        <input nz-input formControlName="address" />
      </nz-form-control>
    </nz-form-item>
    <!-- 身份  -->
    <nz-form-item>
      <nz-form-label [nzSpan]="6" nzRequired>身份</nz-form-label>
      <nz-form-control [nzSpan]="12">
        <nz-select  nzDisabled=true formControlName="identity">
          <nz-option *ngFor="let identity of identityList" [nzValue]="identity.value" [nzLabel]="identity.label">
          </nz-option>
        </nz-select>
      </nz-form-control>
    </nz-form-item>
    <!-- 激活码 -->
    <nz-form-item>
      <nz-form-label [nzSpan]="6" nzRequired>激活码</nz-form-label>
      <nz-form-control [nzSpan]="12">
        <input nz-input formControlName="activeCode" />
      </nz-form-control>
    </nz-form-item>
  </form>
</nz-modal>
<!-- 用户编辑 -->
<nz-modal [(nzVisible)]="isShowEditUserModel" nzTitle="用户编辑" (nzOnCancel)="handleEditUserCancel()"
  (nzOnOk)="handleEditUserOk($event,userForm.value)">
  <form nz-form [formGroup]="userForm">
    <!-- 昵称 -->
    <nz-form-item>
      <nz-form-label [nzSpan]="6" nzRequired>昵称</nz-form-label>
      <nz-form-control [nzSpan]="12" nzHasFeedback nzValidatingTip="Validating..." [nzErrorTip]="nickNameErrorTpl">
        <input nz-input formControlName="nickName" />
        <ng-template #nickNameErrorTpl let-control>
          <ng-container *ngIf="control.hasError('required')">昵称不能为空</ng-container>
        </ng-template>
      </nz-form-control>
    </nz-form-item>
    <!-- 性别 -->
    <nz-form-item>
      <nz-form-label [nzSpan]="6" nzRequired>性别</nz-form-label>
      <nz-form-control [nzSpan]="12" nzHasFeedback nzValidatingTip="Validating..." [nzErrorTip]="genderErrorTpl">
        <nz-radio-group formControlName="gender">
          <label nz-radio [nzValue]="o.value" *ngFor="let o of optionList">{{ o.label }}</label>
        </nz-radio-group>
        <ng-template #genderErrorTpl let-control>
          <ng-container *ngIf="control.hasError('required')">昵称不能为空</ng-container>
        </ng-template>
      </nz-form-control>
    </nz-form-item>
    <!-- 年龄 -->
    <nz-form-item>
      <nz-form-label [nzSpan]="6" nzRequired>年龄</nz-form-label>
      <nz-form-control [nzSpan]="12" nzHasFeedback nzValidatingTip="Validating..." [nzErrorTip]="ageErrorTpl">
        <input nz-input formControlName="age" />
        <ng-template #ageErrorTpl let-control>
          <ng-container *ngIf="control.hasError('required')">昵称不能为空</ng-container>
        </ng-template>
      </nz-form-control>
    </nz-form-item>
    <!-- 手机号 -->
    <nz-form-item>
      <nz-form-label [nzSpan]="6">手机号</nz-form-label>
      <nz-form-control [nzSpan]="12">
        <input nz-input formControlName="phone" />
      </nz-form-control>
    </nz-form-item>
    <!-- 地址 -->
    <nz-form-item>
      <nz-form-label [nzSpan]="6">地址</nz-form-label>
      <nz-form-control [nzSpan]="12">
        <input nz-input formControlName="address" />
      </nz-form-control>
    </nz-form-item>
    <!-- 身份  -->
    <nz-form-item>
      <nz-form-label [nzSpan]="6" nzRequired>身份</nz-form-label>
      <nz-form-control [nzSpan]="12" nzHasFeedback nzValidatingTip="Validating..." [nzErrorTip]="identityErrorTpl">
        <nz-select nzShowSearch nzAllowClear nzPlaceHolder="请选择身份" formControlName="identity">
          <nz-option *ngFor="let identity of identityList" [nzValue]="identity.value" [nzLabel]="identity.label">
          </nz-option>
        </nz-select>
        <ng-template #identityErrorTpl let-control>
          <ng-container *ngIf="control.hasError('required')">昵称不能为空</ng-container>
        </ng-template>
      </nz-form-control>
    </nz-form-item>
    <!-- 激活码 -->
    <nz-form-item>
      <nz-form-label [nzSpan]="6" nzRequired>激活码</nz-form-label>
      <nz-form-control [nzSpan]="12" nzHasFeedback nzValidatingTip="Validating..." [nzErrorTip]="activeCodeErrorTpl">
        <input nz-input formControlName="activeCode" />
        <ng-template #activeCodeErrorTpl let-control>
          <ng-container *ngIf="control.hasError('required')">昵称不能为空</ng-container>
        </ng-template>
      </nz-form-control>
    </nz-form-item>
  </form>
</nz-modal>
<!-- 用户新增 -->
<nz-modal [(nzVisible)]="isShowAddUserModel" nzTitle="用户新增" (nzOnCancel)="handleAddUserCancel()"
  (nzOnOk)="handleAddUserOk($event,userAddForm.value)">
  <form nz-form [formGroup]="userAddForm">
    <!-- 昵称 -->
    <nz-form-item>
      <nz-form-label [nzSpan]="6" nzRequired>昵称</nz-form-label>
      <nz-form-control [nzSpan]="12" nzHasFeedback nzValidatingTip="Validating..." [nzErrorTip]="nickNameErrorTpl">
        <input nz-input formControlName="nickName" />
        <ng-template #nickNameErrorTpl let-control>
          <ng-container *ngIf="control.hasError('required')">昵称不能为空</ng-container>
        </ng-template>
      </nz-form-control>
    </nz-form-item>
    <!-- 性别 -->
    <nz-form-item>
      <nz-form-label [nzSpan]="6" nzRequired>性别</nz-form-label>
      <nz-form-control [nzSpan]="12" nzHasFeedback>
        <nz-radio-group formControlName="gender">
          <label nz-radio nzValue="0">男</label>
          <label nz-radio nzValue="1">女</label>
        </nz-radio-group>
      </nz-form-control>
    </nz-form-item>
    <!-- 年龄 -->
    <nz-form-item>
      <nz-form-label [nzSpan]="6" nzRequired>年龄</nz-form-label>
      <nz-form-control  nzHasFeedback nzValidatingTip="Validating..." [nzErrorTip]="ageErrorTpl">
        <nz-input-number [nzMin]="1" formControlName="age" >
        </nz-input-number>
        <ng-template #ageErrorTpl let-control>
          <ng-container *ngIf="control.hasError('required')">昵称不能为空</ng-container>
        </ng-template>
      </nz-form-control>
    </nz-form-item>
    <!-- 手机号 -->
    <nz-form-item>
      <nz-form-label [nzSpan]="6">手机号</nz-form-label>
      <nz-form-control [nzSpan]="12">
        <input nz-input formControlName="phone" />
      </nz-form-control>
    </nz-form-item>
    <!-- 地址 -->
    <nz-form-item>
      <nz-form-label [nzSpan]="6">地址</nz-form-label>
      <nz-form-control [nzSpan]="12">
        <input nz-input formControlName="address" />
      </nz-form-control>
    </nz-form-item>
    <!-- 身份  -->
    <nz-form-item>
      <nz-form-label [nzSpan]="6" nzRequired>身份</nz-form-label>
      <nz-form-control [nzSpan]="12" nzHasFeedback nzValidatingTip="Validating..." [nzErrorTip]="identityErrorTpl">
        <nz-select nzShowSearch nzAllowClear nzPlaceHolder="请选择身份" formControlName="identity">
          <nz-option *ngFor="let identity of identityList" [nzValue]="identity.value" [nzLabel]="identity.label">
          </nz-option>
        </nz-select>
        <ng-template #identityErrorTpl let-control>
          <ng-container *ngIf="control.hasError('required')">昵称不能为空</ng-container>
        </ng-template>
      </nz-form-control>
    </nz-form-item>
    <!-- 激活码 -->
    <nz-form-item>
      <nz-form-label [nzSpan]="6" nzRequired>激活码</nz-form-label>
      <nz-form-control [nzSpan]="12" nzHasFeedback nzValidatingTip="Validating..." [nzErrorTip]="activeCodeErrorTpl">
        <input nz-input formControlName="activeCode" />
        <ng-template #activeCodeErrorTpl let-control>
          <ng-container *ngIf="control.hasError('required')">昵称不能为空</ng-container>
        </ng-template>
      </nz-form-control>
    </nz-form-item>
  </form>
</nz-modal>